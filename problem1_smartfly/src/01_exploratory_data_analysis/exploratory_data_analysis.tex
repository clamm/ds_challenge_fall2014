\documentclass{article}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\usepackage[sc]{mathpazo}
\usepackage[T1]{fontenc}
\usepackage{geometry}
\geometry{verbose,tmargin=2.5cm,bmargin=2.5cm,lmargin=2.5cm,rmargin=2.5cm}
\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}
\usepackage{url}
\usepackage[unicode=true,pdfusetitle,
 bookmarks=true,bookmarksnumbered=true,bookmarksopen=true,bookmarksopenlevel=2,
 breaklinks=false,pdfborder={0 0 1},backref=false,colorlinks=false]
 {hyperref}
\hypersetup{
 pdfstartview={XYZ null null 1}}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}



\title{SmartFly: Exploratory Data Analysis}


\author{Cindy Lamm}

\maketitle
First load variable names and types of historic data (prepared in an additional csv file):


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{nameTypeDataFile}  \hlkwb{<-} \hlstr{"resources/raw_variables.csv"}
\hlstd{variableNames} \hlkwb{<-} \hlkwd{read.csv}\hlstd{(nameTypeDataFile,} \hlkwc{header}\hlstd{=}\hlnum{TRUE}\hlstd{,} \hlkwc{stringsAsFactors}\hlstd{=}\hlnum{FALSE}\hlstd{)}
\hlstd{variableNames}
\end{alltt}
\begin{verbatim}
##                        name      type
## 1                        id character
## 2                      year    factor
## 3                     month    factor
## 4              day_of_month    factor
## 5               day_of_week    factor
## 6  scheduled_departure_time    factor
## 7    scheduled_arrival_time    factor
## 8                   airline    factor
## 9             flight_number    factor
## 10              tail_number    factor
## 11              plane_model    factor
## 12       seat_configuration    factor
## 13          departure_delay   numeric
## 14           origin_airport    factor
## 15      destination_airport    factor
## 16       distance_travelled   numeric
## 17             taxi_time_in   numeric
## 18            taxi_time_out   numeric
## 19                cancelled   integer
## 20        cancellation_code    factor
\end{verbatim}
\end{kframe}
\end{knitrout}

Then load historic data into R. I set empty strings to \verb+NA+ (because I found them when I looked at a first summary of the data fo r the variables \verb+tail_number+ and \verb+cancellation_code+).
% this takes about 2 minutes 
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{# historicDataFile <- "../../data/smartfly_historic.csv"}
\hlstd{historicDataFile} \hlkwb{<-} \hlstr{"../../data/mod4000.csv"}
\hlstd{trainDataTyped} \hlkwb{<-} \hlkwd{read.csv}\hlstd{(historicDataFile,} \hlkwc{header}\hlstd{=}\hlnum{FALSE}\hlstd{,} \hlkwc{stringsAsFactors}\hlstd{=}\hlnum{FALSE}\hlstd{,}
                           \hlkwc{col.names}\hlstd{=variableNames}\hlopt{$}\hlstd{name,} \hlkwc{colClasses}\hlstd{=variableNames}\hlopt{$}\hlstd{type,}
                           \hlkwc{na.strings}\hlstd{=}\hlkwd{c}\hlstd{(}\hlstr{"NA"}\hlstd{,}\hlstr{""}\hlstd{))}
\hlcom{# convert integer to logical}
\hlstd{trainDataTyped}\hlopt{$}\hlstd{cancelled} \hlkwb{<-} \hlkwd{as.logical}\hlstd{(trainDataTyped}\hlopt{$}\hlstd{cancelled)}
\end{alltt}
\end{kframe}
\end{knitrout}

Checkout first 10 historic data rows
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{head}\hlstd{(trainDataTyped)}
\end{alltt}
\begin{verbatim}
##                    id year month day_of_month day_of_week scheduled_departure_time
## 1 4982598272866526024 2013     8           11           7                     1015
## 2 2750191253294897205 2013     8           23           5                     2045
## 3  321052625414029507 2013     8           26           1                     2050
## 4 2029746680434862717 2013     8           28           3                     1415
## 5 6428004126947779877 2013     8            7           3                     1700
## 6 6342667027143393159 2013     8           31           6                      905
##   scheduled_arrival_time airline flight_number tail_number plane_model seat_configuration
## 1                   1132      US           923      N728UW         757        Three Class
## 2                   2201      US          2523      N511AU         787          Two Class
## 3                   2137      US           455      N376US         737           Standard
## 4                   1524      US           498      N704UW         757                 V3
## 5                   1848      US            84      N413US         737                 V3
## 6                   1017      US          1071      N743UW         747                 V2
##   departure_delay origin_airport destination_airport distance_travelled taxi_time_in
## 1              -5            BWI                 CLT                361            9
## 2              -1            CLT                 CMH                346            3
## 3              -2            CLT                 GSO                 83            4
## 4              -6            PIT                 MCI                773            5
## 5              20            CLT                 PBI                590            5
## 6              -7            PIT                 PHL                267           21
##   taxi_time_out cancelled cancellation_code
## 1            11     FALSE              <NA>
## 2            12     FALSE              <NA>
## 3            10     FALSE              <NA>
## 4             9     FALSE              <NA>
## 5            17     FALSE              <NA>
## 6            14     FALSE              <NA>
\end{verbatim}
\end{kframe}
\end{knitrout}

and a summary of the historic data: 
%this takes about 12 seconds
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{summary}\hlstd{(trainDataTyped)}
\end{alltt}
\begin{verbatim}
##       id              year          month      day_of_month  day_of_week
##  Length:1844        2013: 547   8      :256   16     :  77   1:282      
##  Class :character   2014:1297   9      :240   12     :  73   2:279      
##  Mode  :character               10     :195   23     :  73   3:252      
##                                 3      :140   21     :  71   4:282      
##                                 7      :140   15     :  68   5:269      
##                                 1      :138   7      :  67   6:229      
##                                 (Other):735   (Other):1415   7:251      
##  scheduled_departure_time scheduled_arrival_time    airline    flight_number 
##  800    :  28             1350   :  12           WN     :292   1270   :   5  
##  700    :  27             1715   :  11           AA     :238   1071   :   4  
##  630    :  21             1145   :  10           DL     :207   108    :   4  
##  600    :  19             1025   :   8           UA     :172   1130   :   4  
##  1600   :  18             1050   :   8           NW     :155   1219   :   4  
##  900    :  18             1135   :   8           MQ     :134   1484   :   4  
##  (Other):1713             (Other):1787           (Other):646   (Other):1819  
##   tail_number   plane_model   seat_configuration departure_delay   origin_airport
##  0      :   6   737 :592    Standard   :531      Min.   :-20.000   DFW    : 109  
##  N345   :   5   747 :409    Three Class:213      1st Qu.: -5.000   ORD    : 109  
##  N426UA :   5   757 :228    Two Class  :184      Median :  0.000   ATL    :  99  
##  N366   :   4   777 :180    V1         :357      Mean   :  5.718   LAX    :  67  
##  N421UA :   4   787 :147    V2         :266      3rd Qu.:  3.000   IAH    :  53  
##  (Other):1806   A320:288    V3         :293      Max.   :478.000   LAS    :  49  
##  NA's   :  14                                    NA's   :34        (Other):1358  
##  destination_airport distance_travelled  taxi_time_in    taxi_time_out   cancelled      
##  DFW    :  97        Min.   :  28.0     Min.   : 0.000   Min.   :  0.0   Mode :logical  
##  ORD    :  93        1st Qu.: 308.0     1st Qu.: 4.000   1st Qu.: 10.0   FALSE:1810     
##  ATL    :  85        Median : 569.0     Median : 5.000   Median : 13.0   TRUE :34       
##  LAX    :  73        Mean   : 730.5     Mean   : 6.286   Mean   : 15.1   NA's :0        
##  PHX    :  51        3rd Qu.: 978.5     3rd Qu.: 7.000   3rd Qu.: 18.0                  
##  DTW    :  50        Max.   :3904.0     Max.   :53.000   Max.   :123.0                  
##  (Other):1395                                                                           
##  cancellation_code
##  A   :   6        
##  B   :   3        
##  C   :   3        
##  NA's:1832        
##                   
##                   
## 
\end{verbatim}
\end{kframe}
\end{knitrout}

What are the factor levels for the different variables:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{all_levels} \hlkwb{<-} \hlkwd{sapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlnum{20}\hlstd{,} \hlkwc{FUN}\hlstd{=}\hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{}\hlkwd{levels}\hlstd{(trainDataTyped[,x])\})}
\hlkwd{names}\hlstd{(all_levels)} \hlkwb{<-} \hlstd{variableNames}\hlopt{$}\hlstd{name}
\hlstd{number_of_levels} \hlkwb{<-} \hlkwd{unlist}\hlstd{(}\hlkwd{lapply}\hlstd{(all_levels,} \hlkwc{FUN}\hlstd{=length))}
\hlstd{number_of_levels}
\end{alltt}
\begin{verbatim}
##                       id                     year                    month 
##                        0                        2                       12 
##             day_of_month              day_of_week scheduled_departure_time 
##                       31                        7                      487 
##   scheduled_arrival_time                  airline            flight_number 
##                      799                       17                     1426 
##              tail_number              plane_model       seat_configuration 
##                     1489                        6                        6 
##          departure_delay           origin_airport      destination_airport 
##                        0                      172                      170 
##       distance_travelled             taxi_time_in            taxi_time_out 
##                        0                        0                        0 
##                cancelled        cancellation_code 
##                        0                        3
\end{verbatim}
\begin{alltt}
\hlkwd{lapply}\hlstd{(all_levels,} \hlkwc{FUN}\hlstd{=head,} \hlkwc{n}\hlstd{=}\hlnum{10}\hlstd{)}
\end{alltt}
\begin{verbatim}
## $id
## NULL
## 
## $year
## [1] "2013" "2014"
## 
## $month
##  [1] "1"  "10" "11" "12" "2"  "3"  "4"  "5"  "6"  "7" 
## 
## $day_of_month
##  [1] "1"  "10" "11" "12" "13" "14" "15" "16" "17" "18"
## 
## $day_of_week
## [1] "1" "2" "3" "4" "5" "6" "7"
## 
## $scheduled_departure_time
##  [1] "100"  "1000" "1005" "1010" "1011" "1013" "1014" "1015" "1018" "1019"
## 
## $scheduled_arrival_time
##  [1] "1000" "1001" "1002" "1003" "1004" "1005" "1007" "1008" "1009" "1010"
## 
## $airline
##  [1] "AA" "AS" "B6" "CO" "DH" "DL" "EV" "FL" "HP" "MQ"
## 
## $flight_number
##  [1] "1"    "10"   "100"  "1000" "1006" "1007" "1010" "1018" "102"  "1020"
## 
## $tail_number
##  [1] "0"      "000000" "N050AA" "N055AA" "N056AA" "N063AA" "N069AA" "N077AA" "N082AA"
## [10] "N101DA"
## 
## $plane_model
## [1] "737"  "747"  "757"  "777"  "787"  "A320"
## 
## $seat_configuration
## [1] "Standard"    "Three Class" "Two Class"   "V1"          "V2"          "V3"         
## 
## $departure_delay
## NULL
## 
## $origin_airport
##  [1] "ABQ" "ABY" "ACT" "ACV" "ALB" "AMA" "ANC" "ATL" "AUS" "AZO"
## 
## $destination_airport
##  [1] "ABE" "ABQ" "ACV" "ADQ" "AGS" "ALB" "AMA" "ANC" "ATL" "AUS"
## 
## $distance_travelled
## NULL
## 
## $taxi_time_in
## NULL
## 
## $taxi_time_out
## NULL
## 
## $cancelled
## NULL
## 
## $cancellation_code
## [1] "A" "B" "C"
\end{verbatim}
\end{kframe}
\end{knitrout}
(Note: The number of levels matters if we would want to create a dummy variable for each level. With lots of levels the number of variables would be HUGE and so would be the sparsity of the design matrix.)


Conclusions:
\begin{itemize}
\item \verb+scheduled_departure_time+ (and probably \verb+scheduled_arrival_time+ as well) need to be prefixed with 0 for the all strings with less than 4 characters (assuming "900" means "0900" and thus a time of 09h00)
\item \verb+departure_delay+ needs to be converted to a binary factor (based on definition that only positive delay counts as "delayed")
\end{itemize}

Reformat \verb+scheduled_departure_time+ and \verb+scheduled_arrival_time+ to have all values 4 characters long:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{trainDataTyped}\hlopt{$}\hlstd{scheduled_departure_time} \hlkwb{<-} \hlkwd{as.factor}\hlstd{(}
  \hlkwd{sprintf}\hlstd{(}\hlstr{"%04s"}\hlstd{,} \hlkwd{as.character}\hlstd{(trainDataTyped}\hlopt{$}\hlstd{scheduled_departure_time)))}
\hlstd{trainDataTyped}\hlopt{$}\hlstd{scheduled_arrival_time} \hlkwb{<-} \hlkwd{as.factor}\hlstd{(}
  \hlkwd{sprintf}\hlstd{(}\hlstr{"%04s"}\hlstd{,} \hlkwd{as.character}\hlstd{(trainDataTyped}\hlopt{$}\hlstd{scheduled_arrival_time)))}
\end{alltt}
\end{kframe}
\end{knitrout}

Create binary target variable \verb+is_delayed+:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{trainDataTyped}\hlopt{$}\hlstd{is_delayed} \hlkwb{<-} \hlkwd{factor}\hlstd{(trainDataTyped}\hlopt{$}\hlstd{departure_delay} \hlopt{>} \hlnum{0}
                                    \hlopt{&} \hlstd{trainDataTyped}\hlopt{$}\hlstd{cancelled}\hlopt{==}\hlnum{FALSE}\hlstd{,}
                                    \hlkwc{labels}\hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"delayed"}\hlstd{,} \hlstr{"on_time"}\hlstd{))}
\hlkwd{summary}\hlstd{(trainDataTyped}\hlopt{$}\hlstd{is_delayed)}
\end{alltt}
\begin{verbatim}
## delayed on_time 
##    1315     529
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(trainDataTyped}\hlopt{$}\hlstd{is_delayed)} \hlopt{/} \hlkwd{length}\hlstd{(trainDataTyped}\hlopt{$}\hlstd{is_delayed)}
\end{alltt}
\begin{verbatim}
##   delayed   on_time 
## 0.7131236 0.2868764
\end{verbatim}
\end{kframe}
\end{knitrout}


Look at correlations between continuous variables:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{cor}\hlstd{(trainDataTyped}\hlopt{$}\hlstd{departure_delay, trainDataTyped}\hlopt{$}\hlstd{taxi_time_in,} \hlkwc{use}\hlstd{=}\hlstr{"pairwise.complete.obs"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## [1] -0.01443199
\end{verbatim}
\begin{alltt}
\hlkwd{cor}\hlstd{(trainDataTyped}\hlopt{$}\hlstd{departure_delay, trainDataTyped}\hlopt{$}\hlstd{taxi_time_out,} \hlkwc{use}\hlstd{=}\hlstr{"pairwise.complete.obs"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## [1] 0.04835774
\end{verbatim}
\begin{alltt}
\hlkwd{cor}\hlstd{(trainDataTyped}\hlopt{$}\hlstd{departure_delay, trainDataTyped}\hlopt{$}\hlstd{distance_travelled,} \hlkwc{use}\hlstd{=}\hlstr{"pairwise.complete.obs"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## [1] 0.01826093
\end{verbatim}
\end{kframe}
\end{knitrout}


Look at some dependency between the binary target variable and other factor variables (with reasonably few levels) using the Chi-Square test of independence. The null hypothesis is that the two variables are independent, which we reject if the p-value is smaller than $\alpha=0.001$ (chosen so small due to large sample size):
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{suitable} \hlkwb{<-} \hlkwd{intersect}\hlstd{(}\hlkwd{which}\hlstd{(variableNames}\hlopt{$}\hlstd{type}\hlopt{==}\hlstr{"factor"}\hlstd{),}
                      \hlkwd{which}\hlstd{(number_of_levels} \hlopt{<} \hlnum{20}\hlstd{))}
\hlstd{test_independence} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{col}\hlstd{,} \hlkwc{alpha}\hlstd{)\{}
  \hlstd{result} \hlkwb{<-} \hlkwd{chisq.test}\hlstd{(}\hlkwd{table}\hlstd{(trainDataTyped}\hlopt{$}\hlstd{is_delayed, trainDataTyped[,col]))}
  \hlkwd{return}\hlstd{(result}\hlopt{$}\hlstd{p.value} \hlopt{<} \hlstd{alpha)}
\hlstd{\}}
\hlstd{dependent_with_target} \hlkwb{<-} \hlkwd{sapply}\hlstd{(suitable,} \hlkwc{FUN}\hlstd{=test_independence,} \hlkwc{alpha}\hlstd{=ALPHA)}
\hlkwd{names}\hlstd{(dependent_with_target)} \hlkwb{<-} \hlstd{variableNames}\hlopt{$}\hlstd{name[suitable]}
\hlstd{dependent_with_target}
\end{alltt}
\begin{verbatim}
##               year              month        day_of_week            airline 
##              FALSE              FALSE              FALSE               TRUE 
##        plane_model seat_configuration  cancellation_code 
##               TRUE              FALSE                 NA
\end{verbatim}
\end{kframe}
\end{knitrout}

Save data frame for next step:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{save}\hlstd{(trainDataTyped,} \hlkwc{file}\hlstd{=}\hlstr{"trainDataTyped.Rdata"}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}

% To evaluate variable \texttt{x} in current paragraph use x. 
% To include plots recorded by the PDF device:
% 
% <<boring-plots, fig.width=4, fig.height=4, out.width='.4\\linewidth'>>=
% ## two plots side by side (option fig.show='hold')
% par(mar=c(4,4,.1,.1),cex.lab=.95,cex.axis=.9,mgp=c(2,.7,0),tcl=-.3,las=1)
% boxplot(x)
% hist(x,main='')
% @

\end{document}

% create the exploratory_data_analysis.tex with (takes about 4 minutes!)
% library(knitr)
% knit("../01_exploratory_data_analysis/exploratory_data_analysis.Rnw", output="../01_exploratory_data_analysis/exploratory_data_analysis.tex")
